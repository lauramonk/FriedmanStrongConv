\chapter{Graphs: introduction and basic spectral theory}

In this chapter, we introduce basic definitions and properties
related to (multi)graphs and their spectrum.
We refer the reader to \cite{chung1992} for a more detailed introduction and motivations.

As in Graph, a \emph{graph} $G$ is a set of vertices $V(G)$, and
a set of edges $E(G)$, such that each edge links two unordered, possibly identical vertices.
Note that this definition allows for loops (i.e. edges going from one vertex to itself) and
multi-edges (i.e. multiple edges connecting two vertices). This convention is essential to the proof
we are aiming for, which is why we use Graph instead of the more developed
SimpleGraph.

\section{Basic graph theory}

We here introduce a few basic notions which will be useful to the project.
These definitions should probably be added to Mathlib and hence written carefully,
with good API and following the naming conventions, in particular of SimpleGraph.

\subsection{Darts}

We define a notion of darts, which are oriented edges on the graph.


\begin{definition}
  \label{def:dart}
  \leanok
  \lean{Graph.Dart}
  A \emph{dart} $d$ in a graph $G$ is an oriented edge, meaning it has a start point
  $\spt(d)$, and endpoint $\ept(d)$, is carried by an edge $\edge(d)$, and, in the
  case where $e$ is a loop, it has an additional information encoded in a boolean
  $\in \{0, 1\}$ encoding an orientation.

  We denote as $D(G)$ the set of darts on $G$.
\end{definition}

\begin{definition}
  \label{def:reverse_dart}
  \uses{def:dart}
  \leanok
  \lean{Graph.Dart.reverse}
  To each dart $d$ we associate a \emph{reverse dart} $\symm(d)$ such that:
  \begin{itemize}
    \item $\spt(\symm(d)) = \ept(d)$;
    \item $\ept(\symm(d)) = \spt(d)$;
    \item $\edge(\symm(d)) = \edge(d)$;
    \item if $\edge(d)$ is a loop then the orientation of $\symm(d)$ is
    the negation of the orientation of $d$.
  \end{itemize}
\end{definition}

Here are key properties that must be satisfied by our implementation of darts.

\begin{lemma}
  \label{lem:dart_API}
  \leanok[stated]
  \uses{def:reverse_dart}
  \begin{itemize}
    \item For any dart $d$, $\symm(d) \neq d$.
    \item For any dart $d$, $\symm(\symm(d)) = d$.
    \item For any edge $e$, there exists a dart $d$ such that $\edge(d)=e$.
    \item For any $d, d'$, if $\edge(d)=\edge(d')$ then $d=d'$ or $d=\symm(d')$.
  \end{itemize}
\end{lemma}

\begin{definition}
  \label{def:dartset}
  \uses{def:dart}
  Let $x \in V(G)$. The \emph{dartset} of $x$ is the set
  \begin{equation}
    \dartset(x) := \{ d \in D(G) \, : \, \spt(d)=x\}.
  \end{equation}
\end{definition}

\begin{definition}
  \label{def:dartset_pair}
  \uses{def:dart}
  Let $x$, $y \in V(G)$.
  We define the dartset of $(x,y)$ as
  \begin{equation*}
    \dartset(x,y)
    = \{ d \in D(G) : \spt(d) = x, \ept(d) = y\}.
  \end{equation*}
\end{definition}

\begin{lemma}
  \label{lem:adjacent_vs_dart}
  \uses{def:dartset,def:dartset_pair}
  Let $x, y \in V(G)$.
  The following are equivalent:
  \begin{enumerate}
    \item $x$ and $y$ are adjacent;
    \item there exists $d \in \dartset(x)$ such that $\ept(d)=y$;
    \item $\dartset(x,y)$ is not empty.
  \end{enumerate}
\end{lemma}

\begin{proof}
  We start by proving (1) $\Rightarrow$ (2).
  Assume $x$ and $y$ are adjacent.
  Then there exists an edge $e$ linking $x$ and $y$.
  The function $\edge$ is surjective so there exists $d \in D(G)$ such that $\edge(d)=e$.
  $e$ links $x$ and $y$ but also $\spt(d)$ and $\ept(d)$ so:
  \begin{itemize}
    \item either $x=\spt(d)$ and $y=\ept(d)$, in which case $d \in \dartset(x)$
    satisfies the claim;
    \item otherwise $x = \ept(d) = \spt(\symm(d))$ and $y = \spt(d) = \ept(\symm(d))$ and
    hence $\symm(d) \in \dartset(x)$ satisfies the claim.
  \end{itemize}

  The implication (2) $\Rightarrow$ (3) is immediate by definition of $\dartset(x,y)$.

  To conclude, (3) $\Rightarrow$ (1) because, if $d \in \dartset(x,y)$, then $\edge(d)$
  links $x$ and $y$ and hence they are adjacent.
\end{proof}

\begin{lemma}
  \label{lem:edge_preimage}
  \uses{def:dart}
  For any $e \in E(G)$, there exists $d \in D(G)$ such that
  $\edge^{-1}(\{e\}) = \{d, \symm(d)\}$.
\end{lemma}

\begin{proof}
  Let $e \in E(G)$.
  The map $\edge$ is surjective so there exists $d \in D(G)$ such that $\edge(d)=e$.
  We have $\edge(\symm(d))=\edge(d)=e$. This proves $\{d, \symm(d)\} \subseteq \edge^{-1}(\{e\})$.
  For the other direction, if $d' \in D(G)$ satisfies $\edge(d')=e$, then
  $\edge(d)=\edge(d')$ which implies by definition that $d'=d$ or $d'=\symm(d)$, which is the
  claim.
\end{proof}

\begin{lemma}
  \label{lem:edge_range_of_darset}
  \uses{lem:edge_preimage,def:dartset_pair}
  Let $x,y \in V(G)$.
  The range of the restriction of the function $\edge$
  to $\dartset(x,y)$
  is exactly the set $\{e \in E(G) : e \text{ links } x, y\}$.
  Furthermore, this map is $1$-to-$1$ if $x \neq y$ and $2$-to-$1$ if $x=y$.
\end{lemma}

\begin{proof}
  Let $d \in \dartset(x,y)$. Then, $\edge(d) \in E(G)$ links $\spt(d)=x$
  and $\ept(d)=y$. So $\edge(d)$ belongs in the claimed set.

  Now take $e \in E(G)$ linking $x$ and $y$. By Lemma \ref{lem:edge_preimage},
  there exists $d \in D(G)$ such that $\edge^{-1}(\{e\}) = \{d, \symm(d)\}$.
  We check that $d$ or $\symm(d)$ belongs in $\dartset(x,y)$, and that
  both of them do iff $x=y$, which leads to the claim.
\end{proof}

We can alternatively define a graph from its darts in the following fashion.

\begin{definition}
  \label{def:dartlike}
  Let $V$ be a set. A \emph{dart-like structure} on $V$ is the data of a set of darts $D$,
  together with maps $\spt, \ept : D \rightarrow V$ and
  $\symm : D \rightarrow D$ satisfying the following:
  \begin{itemize}
    \item $\spt \circ \symm = \ept$ and $\ept \circ \symm = \spt$;
    \item $\symm$ is an involution with no fixed point.
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:dart_eq_rel}
  \uses{def:dartlike}
  Let $V$ be a set and $D$, $\spt, \ept, \symm$ be a dart-like structure.
  We define a relation on $D$ by:
  \begin{equation*}
    \forall d, d' \in D,
    \quad d \sim d' \Leftrightarrow (d=d' \text{ or } d = \symm(d')).
  \end{equation*}
\end{definition}

\begin{lemma}
  \label{lem:dart_eq_rel}
  \uses{def:dart_eq_rel}
  The relation $\sim$ on $D$ is an equivalence relation, and all of its equivalence
  classes are of the form $\{d, \symm(d)\}$ (the two of which are distinct).
\end{lemma}

\begin{proof}
  This is a classic fact for involutions with no fixed points.
\end{proof}

\begin{definition}
  \label{def:graph_of_dart}
  Let $V$ be a set and $D$, $\spt, \ept, \symm$ be a dart-like structure.
  We define a graph $G$ associated to this structure by taking:
  \begin{itemize}
    \item $V(G) := V$ as the vertex set;
    \item $E(G) := D(G) \diagup \sim$ as the edge set;
    \item for $e \in E(G)$, if $d \in D(G)$ is a representant of $e$,
    then $e$ links $\spt(d)$ and $\ept(d)$.
  \end{itemize}
\end{definition}

\begin{proof}
  The only thing to check is that the definition of the links does not depend on the
  choice of a representative, which is true since
  $\spt \circ \symm = \ept$ and $\ept \circ \symm = \spt$.
\end{proof}

\begin{theorem}
  \label{thm:dart_of_graph_of_dart}
  \uses{def:graph_of_dart,def:dart}
  The graph constructed in Definition \ref{def:graph_of_dart} is a graph,
  and $D(G) := D$, $\spt$, $\ept$, $\symm$ are darts of this graph, with the projection
  edge map $\edge : D(G) \rightarrow E(G)$.
\end{theorem}

\subsection{Subgraphs}

The definition of subgraph is easier for Graph as the vertexset is just a subset.

\begin{definition}
  \label{def:subgraph}
  A \emph{subgraph} $H$ of $G$ is a graph (ofthe same type as $G$) defined by:
  \begin{itemize}
    \item a vertex set $V(H)$ included in the vextex set of $G$
    \item an edge set $E(H)$ included in the edge set of $H$
    \item the same $\islink$ relation, i.e. if $e$ links $x$ and $y$ in $H$ then it
    also links $x$ and $y$ in $G$.
  \end{itemize}
\end{definition}

\begin{lemma}
  \label{lem:subgraph_adj_graph}
  \uses{def:subgraph}
  Let $H$ be a subgraph of $G$.
  For any $x$, $y$ in $V(H)$, if $x$ and $y$ are adjacent for $H$, then they are
  adjacent for $G$.
\end{lemma}

\begin{definition}
  \label{def:max_subgraph,def:min_subgraph}
  \uses{def:subgraph}
  We define the \emph{union}, resp. \emph{intersection} of two subgraphs by taking the union of
  their respective vertex sets and edge sets.
\end{definition}

\begin{definition}
  \label{def:isinduced}
  \uses{def:subgraph}
  A subgraph $H$ of $G$ is \emph{induced} if, for any $x, y \in V(H)$, for any $e \in E(G)$,
  if $e$ links $x$ and $y$ in $G$, then $e \in E(H)$.
\end{definition}

\begin{definition}
  \label{def:induced_subgraph}
  \uses{def:subgraph}
  Let $U$ be a subset of $V(G)$. Then we define a subgraph $H$ induced by $U$ by letting:
  \begin{itemize}
    \item $V(H) := U$;
    \item $E(H) := \{ e \in E(G) : \text{ both endpoints of }e \text{ lie in } U\}$.
  \end{itemize}
\end{definition}

\begin{lemma}
  \label{lem:induced_iff_isinduced}
  \uses{def:isinduced,def:induced_subgraph}
  A subgraph is induced iff it is induced from as subset of $V(G)$.
\end{lemma}

\subsection{Walks and reachability}

We define a notion of walk on the graph.

\begin{definition}
  \label{def:walk}
  \leanok
  \lean{Graph.Walk}
  Let $x, y \in V(G)$. A \emph{walk} from $x$ to $y$ on $G$ is given by two finite lists:
  \begin{itemize}
    \item a list $(v_i)_{0 \leq i \leq m}$ of vertices in $V(G)$;
    \item a list $(e_i)_{1 \leq i \leq m}$ of edges in $E(G)$;
  \end{itemize}
  satisfying the following:
    \begin{itemize}
      \item $v_0=x$ and $v_m=y$;
      \item for any $i \in \{1, \ldots, m\}$, $e_i$ links $v_{i-1}$ and $v_i$.
    \end{itemize}
\end{definition}

\begin{definition}
  \label{def:length}
  \uses{def:walk}
  \leanok
  \lean{Graph.Walk.length}
  The \emph{length} of a walk is its number of edges.
\end{definition}

The following definition is actually what we want if we want to count walks
on the multi-graph, I am not sure if it would be accepted as a definition though?
\begin{definition}
  \label{def:dartwalk}
  Let $x, y \in V(G)$.
  A \emph{dartwalk} from $x$ to $y$ on $G$ is
  a finite list of darts $(d_i)_{1 \leq i \leq m}$ where:
  \begin{itemize}
    \item $\spt(d_1)=x$;
    \item $\ept(d_m)=y$;
    \item for all $1 \leq i < m$, $\ept(d_i)=\spt(d_{i+1})$.
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:dartwalk_support}
  \uses{def:dartwalk}
  The \emph{support} of the dartwalk $(d_i)_{1 \leq i \leq m}$
  is the list $(x_i)_{0 \leq i \leq m}$ with $x_0=\spt(d_1)$ and
  $x_i = \ept(d_i)$ for $1 \leq i \leq m$.
\end{definition}

\begin{definition}
  \label{def:reachable}
  \uses{def:walk}
  \leanok
  \lean{Graph.Reachable}
  We define a binary relation on $V(G)$ by: $x \sim y$ if there exists a walk
  from $x$ to $y$ on $G$. We then say $x$ and $y$ are \emph{reachable}.
\end{definition}

\begin{proposition}
  \label{prop:reachable_is_equivalence}
  \uses{def:reachable}
  \leanok
  \lean{Graph.Reachable.rfl}
  The reachability relation is an equivalence relation on $V(G)$.
\end{proposition}

\begin{proof}
  The reachability relation is reflexive: $x \sim x$ for any $x \in V(G)$.
  Indeed, let $x \in V(G)$. We take $m=0$ and set $v_0=x$. Then this is a walk from
  $x$ to $x$ on $G$.

  The reachability relation is symmetric: if $x \sim y$ then  $y \sim x$.
  Let $x$, $y$ be two vertices. We assume $x \sim y$. Let $(v_i)_{0 \leq i \leq m}$ and $(e_i)_{1 \leq i \leq m}$
  be a walk from $x$ to $y$. Then $(v_{m-i})_{0 \leq i \leq m}$ and $(e_{m+1-i})_{1 \leq i \leq m}$
  is a walk from $y$ to $x$. So $y \sim x$.

  The reachability relation is transitive: if $x \sim y$ and $y \sim z$ then
  $x \sim z$.
  Assume $x \sim y$ and $y \sim z$. Let $(v_i)_{0 \leq i \leq m}$ and $(e_i)_{1 \leq i \leq m}$
  be a walk from $x$ to $y$ and $(v_i')_{0 \leq i \leq m'}$, $(e_i')_{1 \leq i \leq m'}$
  be a walk from $y$ to $z$.
  We let $m''=m+m'$ and define for $i \in \{0, \ldots, m'\}$
  \begin{equation}
    v_i'' := \begin{cases}
      v_i & \text{if } i \leq m \\
      v_{i-m-1}' & \text{otherwise}
    \end{cases}
  \end{equation}
 and for $i \in \{1, \ldots, m'\}$
   \begin{equation}
    e_i'' := \begin{cases}
      e_i & \text{if } i \leq m \\
      e_{i-m}' & \text{otherwise}.
    \end{cases}
  \end{equation}
  Then this is a walk from $x$ to $z$, hence $x \sim z$.
\end{proof}

\begin{lemma}
  \label{lem:adj_towalk}
  \uses{def:reachable}
  \leanok
  \lean{Graph.Adj.reachable}
  Let $x$, $y$ in $V(G)$. If $x$ and $y$ are adjacent then $x$ and $y$ are reachable.
\end{lemma}

\begin{proof}
  By definition of adjacency, there exists an edge $e \in E(G)$ linking $x$ and $y$.
  Then the walk $(x, y)$ and $(e)$ is a walk from $x$ to $y$.
\end{proof}

\begin{definition}
  \label{def:path}
  \uses{def:walk}
  Let $x, y \in V(G)$.
  A \emph{path} from $x$ to $y$ on $G$ is a walk $(v_i)_{0 \leq i \leq m}$,
  $(e_i)_{1 \leq i \leq m}$
  such that, for all $i \neq j$, $v_i \neq v_j$.
\end{definition}

\begin{definition}
  \label{def:dartpath}
  \uses{def:dartwalk_support}
  A dartwalk $(d_i)_{1 \leq i \leq k}$ is a \emph{dartpath} if all vertices in its
  support are distinct.
\end{definition}

\begin{definition}
  \label{def:tree}
  The graph $G$ is a \emph{tree} if, for all $x$, $y \in V(G)$,
  there exists a unique dartpath from $x$ to $y$.
\end{definition}

\subsection{Connectedness}

We define the notion of connectedness and the connected components of a graph.

\begin{definition}
  \label{def:preconnected}
  \uses{def:reachable}
  \leanok
  \lean{Graph.Preconnected}
  A graph is \emph{preconnected} if any pair of vertices is reachable.
\end{definition}

\begin{definition}
  \label{def:connected}
  \uses{def:preconnected}
  \leanok
  \lean{Graph.Connected}
  The graph $G$ is \emph{connected} if it is preconnected and $V(G)$ is not empty.
\end{definition}

\begin{lemma}
  \label{lem:connected_iff_exists_forall_reachable}
  \uses{def:connected}
  The graph $G$ is connected if and only if there exists $x \in V(G)$ such that,
  for all $y \in V(G)$, $x$ and $y$ are reachable.
\end{lemma}

\begin{definition}
  \label{def:connected_component}
  \uses{prop:reachable_is_equivalence}
  A \emph{connected component} of $G$ is an equivalence class of $V(G)$ for
  the relation reachable.
\end{definition}

\begin{definition}
  \label{def:connected_component_Mk}
  \uses{def:connected_component}
  For any vertex $x$, we define $\ccm(x)$ to be the unique connected component
  of $G$ containing $x$.
\end{definition}

\begin{lemma}
  \label{lem:cc_eq}
  \uses{def:connected_component_Mk}
  Let $x, y \in V(G)$. Then $\ccm(x) = \ccm(y)$ iff $x$ and $y$ are reachable.
\end{lemma}

\begin{theorem}
  \label{thm:cc_is_connected}
  \uses{def:induced_subgraph,def:connected,def:connected_component}
  Let $C$ be a connected component of $G$. Then the subgraph induced by $C$ is connected.
\end{theorem}

\begin{definition}
  \label{def:set_cc}
  \uses{def:connected_component}
  We denote as $\cc(G)$ the set of connected components of $G$.
\end{definition}

\begin{proposition}
  \label{prop:cc_is_partition}
  \uses{def:set_cc}
  $\cc(G)$ is a partition of $V(G)$.
\end{proposition}

\begin{lemma}
  \label{lem:bound_cc}
  \uses{prop:cc_is_partition}
  If $V(G)$ is finite, then $\cc(G)$ is finite and $\#V(G) \leq \# \cc(G)$.
\end{lemma}


\subsection{Locally finite graph, degree and regularity}

\begin{definition}
  \label{def:locally_finite_at}
  \uses{def:dartset}
  Let $x$ be a vertex of $G$.
  We say $G$ is \emph{locally finite at $x$} if $\dartset (x)$ is finite.
\end{definition}

\begin{definition}
  \label{def:locally_finite}
  \uses{def:locally_finite_at}
  $G$ is said to be \emph{locally finite} if, for all $x \in V(G)$,
  $G$ is locally finite at $x$.
\end{definition}

\begin{definition}
  \label{def:degree}
  \uses{def:locally_finite_at}
  Let $x$ be a vertex of $G$. We assume $G$ is locally finite at $x$.
  The \emph{degree} of $x$ is defined as $\mathrm{deg}(x) = \# \dartset(x)$.
\end{definition}

\begin{lemma}
  \label{lem:darset_loop_even}
  \uses{lem:edge_range_of_darset}
  If $G$ is locally finite at $x \in V(G)$, then
   $\# \dartset(x,x)$ is an even number.
\end{lemma}

\begin{lemma}
  \label{lem:degree_inc_loop}
  \uses{def:degree,lem:edge_range_of_darset}
  Let $x \in V(G)$.
  $G$ is locally finite at $x$ iff $\incset(x)$ is finite, and in this case,
  \begin{equation*}
    \deg(x) = \# \incset(x) + \loopset(x).
  \end{equation*}
\end{lemma}

\begin{proof}
  Using Lemma \ref{lem:edge_range_of_darset},
  \begin{align*}
    \deg(x)
    & = \sum_{y \in V(G)} \# \dartset(x,y) \\
    & = 2 \# \{e \in E(G) : e \text{ links }x,x\}
    + \sum_{y \in V(G), y \neq x} \# \{e \in E(G) : e \text{ links }x,y\}\\
    & = 2 \# \loopset(x) + (\# \incset(x) - \# \loopset(x))
  \end{align*}
  which leads to the desired equality. Hence $G$ is locally finite at $x$ iff
  $\incset(x)$ and $\loopset(x)$ are both finite, which is equivalent to
  $\incset(x)$ being finite as $\loopset(x) \subseteq \incset(x)$.
\end{proof}

\begin{definition}
  \label{def:regular}
  \uses{def:locally_finite, def:degree}
  Let $\delta$ be a non-negative integer.
  We say $G$ is \emph{regular of degree $\delta$} if it is not empty, locally finite and,
  for every $x \in V(G)$, $\deg (x) = \delta$.
\end{definition}

\begin{lemma}
  \label{lem:regular_zero}
  \uses{def:regular}
  The graph $G$ is regular of degree $0$ iff $E(G)=\emptyset$.
\end{lemma}

\begin{definition}
  \label{def:locally_bounded}
  \uses{def:degree,def:locally_finite}
  We say $G$ is \emph{locally bounded} if
  it is locally finite and there exists a constant $D$ such that,
  for all $x \in V(G)$, $\deg(x) \leq D$.
\end{definition}


\subsection{Bipartiteness}

\begin{definition}
  \label{def:bipartite}
  The graph $G$ is \emph{bipartite} if there exists a partition $U_1$,
  $U_2$ of $V(G)$ such that, for all $e \in E(G)$, $e$ links an element of $U_1$
  and an element of $U_2$.
\end{definition}

\subsection{Metric}

\begin{definition}
  \label{def:edistance}
  \uses{def:length}
  \leanok
  \lean{Graph.edist}
  Let $x, y \in V(G)$. The \emph{extended distance} $\edist(x,y)$
  between $x$ and $y$
  is the length of the shortest walk from $x$ to $y$ (with value in
  $\N \cup \{\infty\}$).
\end{definition}

\begin{lemma}
  \label{lem:edistance_zero_infty}
  \uses{def:edistance}
  Let $x, y \in V(G)$.
\begin{itemize}
  \item   $\edist(x,y) = 0$ iff $x = y$;
  \item $\edist(x,y) \neq \infty$ iff there exists
  a walk from $x$ to $y$.
\end{itemize}\end{lemma}

\begin{definition}
  \label{def:distance}
  \uses{def:edistance}
  The \emph{distance} between $x$ and $y$
  is $\dist(x,y) = \edist(x,y).\mathrm{toNat}$.
\end{definition}

\begin{lemma}
  \label{lem:distance_ne_zero}
  \uses{def:distance,lem:edistance_zero_infty}
  Let $x, y \in V(G)$. $\dist(x,y) \neq 0$ iff $x \neq y$ and there exists
  a walk from $x$ to $y$.
\end{lemma}

\begin{lemma}
  \label{lem:distance_take}
  \uses{def:distance}
  Let $x, y \in V(G)$, we assume $\dist(x,y) \neq 0$. Then there exists a walk
  of length $\dist(x,y)$ from $x$ to $y$.
\end{lemma}

\begin{definition}
  \label{def:ball}
  \uses{def:edistance}
  Let $x \in V(G)$ and $r \in \N$.
  We define the \emph{ball $B_r(x)$
  of radius $r$ centered at $x$} as the set of vertices
  $y \in V(G)$ such that $\edist(x,y)\leq r$.
\end{definition}

\begin{definition}
  \label{def:circle}
  \uses{def:edistance}
  Let $x \in V(G)$ and $r \in \N$.
  We define the \emph{circle $C_r(x)$
  of radius $r$ centered at $x$} as the set of vertices
  $y \in V(G)$ such that $\edist(x,y) = r$.
\end{definition}

\begin{lemma}
  \label{lem:ball_circle_radius_zero}
  \uses{lem:edistance_zero_infty,def:circle,def:ball}
  For any $x \in V(G)$, $B_0(x) = C_0(x) = \{x\}$.
\end{lemma}

\begin{lemma}
  \label{lem:circle_vs_ball}
  \uses{def:ball,def:circle}
  For any $x \in V(G)$, $r \in \N$,
  $C_r(x) \subseteq B_r(x)$ and if
  $r \geq 1$ then $C_r(x) = B_r(x) - B_{r-1}(x)$.
\end{lemma}

\begin{lemma}
  \label{lem:circle_r_vs_rplusone}
  \uses{def:circle,lem:distance_take}
  Let $x \in V(G)$ and $r \in \N$.
  For any $y \in C_{r+1}(x)$, there exists $z \in C_r(x)$ such that
  $y$ and $z$ are adjacent.
\end{lemma}

\begin{proof}
  Take $y \in C_{r+1}(x)$. Then there exists a walk $(v_i)_{0 \leq i \leq r+1}$,
  $(e_i)_{1 \leq i \leq r+1}$ from $x$ to $y$.
  We take $z=v_{r}$ and check it is adjacent to $y$ and lies in $C_r(x)$.
\end{proof}

\begin{proposition}
  \label{prop:growth_ball}
  \uses{def:locally_bounded,lem:circle_vs_ball,lem:ball_circle_radius_zero,lem:circle_r_vs_rplusone}
  Assume $G$ is locally bounded and let $D = \sup_{x \in V(G)} \deg (x)$.
  Then, for any $x \in V(G)$, any $r \in \N$,
  $\# B_r(x) \leq D^r$.
\end{proposition}

\begin{proof}
  todo
\end{proof}

\subsection{Diameter}

\begin{definition}
  \label{def:ediameter}
  \uses{def:edistance}
  The \emph{extended diameter} of a graph $G$ is
  $\ediam(G) := \sup_{x,y \in V(G)} \edist(x,y)$.
\end{definition}


\begin{definition}
  \label{def:diameter}
  \uses{def:ediameter}
  The \emph{diameter} of $G$ is $\diam(G) = \ediam(G).\mathrm{toNat}$.
\end{definition}

\begin{lemma}
  \label{lem:connected_iff_diam_ne_zero}
  \uses{def:connected,def:diameter}
  Assume $V(G)$ is finite and non-empty. Then $\diam(G) \neq 0$ if and only if
  $G$ is connected.
\end{lemma}
\begin{proof}
  To be adapted from SimpleGraph.
\end{proof}

\begin{lemma}
  \label{lem:vertexset_incl_ball_diam}
  \uses{def:diameter,def:ball}
  Assume $G$ is a graph of finite diameter.
  For any $x \in V(G)$, $V(G)$ is included in the ball of radius $\diam(G)$
  centered at $x$.
\end{lemma}

\begin{proof}
  Let $x, y \in V(G)$. By definition of the diameter, $\dist(x,y) \leq \diam(G)$
  and hence $y$ lies in the ball of radius $\diam(G)$ centered at $x$.
\end{proof}

\begin{proposition}
  \label{prop:bound_diameter_regular}
  \uses{lem:vertexset_incl_ball_diam,prop:growth_ball}
  Let $G$ be a regular graph of degree $\de$. Assume $V(G)$ is finite and not empty.
  Then
  \begin{equation}
    \diam(G) \geq \log_{\de} \# V(G).
  \end{equation}
\end{proposition}

\begin{proof}
  Let $x \in V(G)$.
  By Lemma \ref{lem:vertexset_incl_ball_diam}, if $r := \diam(G)$,
  then $V(G) \subseteq B_r(x)$. In particular $\# V(G) \leq \# B_r(X) \leq \de^r$
  by Proposition \ref{prop:growth_ball}.
\end{proof}

\section{Space of functions on a graph}

Let $G$ be a graph.

Throughout this blueprint, we will be interested in the space $\C^{V(G)}$
of functions $V(G) \rightarrow \C$. This space is a $\C$ vectorial space. Note that, in this
context, $0$ is the constant function equal to~$0$.

For the purpose of analysis, we will be interested in the Hilbert space $\ell^2(G) := \ell^2(V(G))$,
which is defined as the set of functions $f : V(G) \rightarrow \C$ which are square-summable,
equipped with the inner product
$$\langle f, g \rangle = \sum_{x \in V(G)} f(x) \overline{g(x)}.$$
Note that, whenever $V(G)$ is finite, $\ell^2(G) = \C^{V(G)}$ as any finite sequence is
square-summable.
The space $\B(\ell^2(G))$ of bounded linear operators on $\ell^2(G)$ is a unital $\C^*$-algebra.

Let us introduce several useful families of functions.

\subsection{Constant fonctions}

\begin{definition}
  \label{def:constant_function}
  A function $V(G) \rightarrow \C$ is \emph{constant} if, for all $x, y \in V(G)$,
  $f(x)=f(y)$.
\end{definition}

\begin{definition}
  \label{def:constant_one}
  The constant function equal to $1$ is defined by
  \begin{equation}
    \const :
    \begin{cases}
      V(G) & \rightarrow \C \\
      x & \mapsto 1.
    \end{cases}
  \end{equation}
\end{definition}

\begin{lemma}
  \label{lem:one_neq_zero}
  \uses{def:constant_one}
  Assume $V(G)$ is not empty. Then $\const \neq 0$.
\end{lemma}

\begin{proof}
  If $V(G)$ is not empty, then there exists $x \in V(G)$.
  Then $\const (x) = 1 \neq 0$, and hence $\const \neq 0$.
\end{proof}

\begin{theorem}
  \label{thm:space_constant}
  \uses{def:constant_function,def:constant_one}
  Assume $V(G)$ is not empty. Then the space of constant functions is
  a vectorial subspace of $\C^{V(G)}$, of dimension $1$, generated by $\const$.
\end{theorem}

\begin{proof}
  We directly check that:
  \begin{itemize}
    \item the constant function equal to $0$ is constant;
    \item for any constant functions $f_1$, $f_2$ and any $c \in \C$,
    the function $f_1+cf_2$ is also constant;
  \end{itemize}
  both by direct application of the definition.
  We also check that the function $\const$ is constant.

  Let $f : V(G) \rightarrow \C$ be a constant function. Since $V(G)$ is not
  empty there exists $x \in V(G)$. Then for all $y \in V(G), f(y) = f(x) \const(y)$,
  so $f = f(x) \const$, which allows to conclude.
\end{proof}

\begin{lemma}
  \label{lem:constant_is_l2}
  \uses{def:constant_function}
  The space of constant functions is included in $\ell^2(G)$
  if and only if $V(G)$ is finite.
\end{lemma}

\begin{lemma}
  \label{lem:orth_constant}
  \uses{thm:space_constant}
  Assume $V(G)$ is non-empty and finite.
  Then, the orthogonal of the space of constant functions is
  \begin{equation*}
    \const^\perp = \Big\{ f : V(G) \rightarrow \C :
    \sum_{x \in V(G)}f(x)=0 \Big\}.
  \end{equation*}
\end{lemma}

\begin{proof}
  By definition of the orthogonal, $\const^\perp$ is the space of functions $f \in \ell^2(G)$
  such that $\langle f, \const \rangle = 0$.
  Since $V(G)$ is finite all functions $V(G) \rightarrow \C$ are in $\ell^(G)$.
  By definition of the scalar product and the constant function,
  $\langle f, \const \rangle = \sum_{x \in V(G)}f(x)$.
\end{proof}

\subsection{Indicator functions}

\begin{definition}
  \label{def:indicator_function}
  Let $U$ be a subset of $V(G)$. We define the \emph{indicator function}
  $\const_U : V(G) \rightarrow \C$ by
  \begin{equation}
    \const_U (x) =
    \begin{cases}
      1 & \text{if } x \in U \\
      0 & \text{otherwise}.
    \end{cases}
  \end{equation}
\end{definition}

\begin{lemma}
  \label{lem:indicator_ell2}
  \uses{def:indicator_function}
  The indicator function of a set $U$ is in $\ell^2(G)$ iff $U$ is finite.
\end{lemma}

\begin{lemma}
  \label{lem:partition_unity}
  \uses{def:indicator_function}
  Let $(\pi_U)_{U \in I}$ be a partition of $V(G)$. Then $\const = \sum_{U \in I} \const_U$.
\end{lemma}

\subsection{Locally constant functions}

\begin{definition}
  \label{def:locally_constant}
  A function $f : V(G) \rightarrow \C$ is said to be \emph{locally constant}
  if, for all $x,y \in V(G)$, if $x$ is adjacent to $y$, then $f(x)=f(y)$.
\end{definition}

We have the following dart versions of the definition.

\begin{lemma}
  \label{lem:dart_locally_constant}
  \uses{def:locally_constant,lem:adjacent_vs_dart}
  Let $f : V(G) \rightarrow \C$. The following are equivalent:
  \begin{enumerate}
    \item  $f$ is locally constant;
    \item for every $x \in V(G)$, for every $d \in \dartset(x)$,
    $f(x)=f(\ept(d))$.
    \item for every $d \in D(G)$, $f(\spt(d))=f(\ept(d))$.
  \end{enumerate}
\end{lemma}

\begin{lemma}
  \label{lem:locally_constant_walk}
  \uses{def:reachable,def:locally_constant}
  Let $f : V(G) \rightarrow \C$ be a locally constant function.
  For any $x, y \in V(G)$, if $x$ and $y$ are reachable, then $f(x)=f(y)$.
\end{lemma}

\begin{proof}
  By induction.
\end{proof}

\begin{lemma}
  \label{lem:locally_constant_preconnected}
  \uses{lem:locally_constant_walk,def:preconnected,def:constant_function}
  A locally constant function on a preconnected graph is constant.
\end{lemma}

\begin{proof}
  Let $G$ be a preconnected graph and $f : V(G) \rightarrow \C$ be a locally
  constant function.
  For any $x$, $y$ in $V(G)$, by Definition \ref{def:preconnected}, there
  exists a walk from $x$ to $y$. Lemma \ref{lem:locally_constant_walk}
  this implies $f(x)=f(y)$. Hence by Definition \ref{def:constant_function},
  $f$ is constant.
\end{proof}

\begin{lemma}
  \label{lem:locally_constant_subgraph}
  \uses{lem:subgraph_adj_graph,def:locally_constant}
  The restriction of a locally constant function
  to a subgraph is locally constant on that subgraph.
\end{lemma}

\begin{proof}
  Let $f$ be a locally constant function on $G$, and $H$ be a subgraph of $G$.
  Let $x, y$ be adjacent vertices in $H$. By Lemma \ref{lem:subgraph_adj_graph},
  $x$ and $y$ are also adjacent in $G$. Then $f(x)=f(y)$.
\end{proof}

\begin{theorem}
  \label{thm:locally_constant_cc}
  \uses{lem:locally_constant_subgraph,thm:cc_is_connected,
  lem:locally_constant_preconnected,lem:cc_eq}
  A function $f$ is locally constant if and only if its restriction to each
  connected component is a constant function.
\end{theorem}

\begin{proof}
  Assume $f$ is locally constant. Let $C$ be a connected component of $G$.
  By Lemma \ref{lem:locally_constant_subgraph}, the restriction of $f$ to $C$
  is locally constant.
  By Theorem \ref{thm:cc_is_connected}, $C$ is preconnected.
  So by Lemma \ref{lem:locally_constant_preconnected}, the restriction of $f$ to $C$
  is constant.

  Assume the restriction of $f$ to each connected component is constant.
  Let $x$, $y$ be adjacent vertices. Then by Lemma \ref{lem:cc_eq},
  $\ccm(x) = \ccm(y)$ which implies that $y \in \ccm(x)$. This allows to conclude
  since $f$ is constant on $\ccm(x)$
  by hypothesis and Theorem \ref{thm:cc_is_connected}.
\end{proof}

\begin{lemma}
  \label{lem:indicator_cc_loc_const}
  \uses{thm:locally_constant_cc,def:indicator_function}
  The indicator function of a connected component is locally constant.
\end{lemma}

\begin{lemma}
  \label{thm:locally_constant_basis}
  \uses{lem:indicator_cc_loc_const}
  The space of locally constant functions is a vectorial subspace of
  the space of functions $V(G) \rightarrow \C$, and the $\{\const_C, C \in \cc(G)\}$
  are a basis of this space.
\end{lemma}

\begin{proof}
  We directly check that:
  \begin{itemize}
    \item the constant function equal to $0$ is locally constant;
    \item for any locally constant functions $f_1$, $f_2$ and any $c \in \C$,
    the function $f_1+cf_2$ is also locally constant;
  \end{itemize}
  both by direct application of the definition.

  Now, for any connected component $C$, $\const_C$ is locally
  constant by Lemma \ref{lem:indicator_cc_loc_const}.

  We prove these functions form a basis using the fact that, by
  Proposition \ref{prop:cc_is_partition} and Lemma \ref{lem:partition_unity},
  \begin{equation*}
    \const = \sum_{C \in \cc(G)} \const_C
  \end{equation*}
  and hence if $f$ is locally constant,
    \begin{equation*}
      \forall x \in V(G),
    f(x) = \sum_{C \in \cc(G)} f(x) \const_C(x).
  \end{equation*}
  The function $f$ is constant on each connected component so this is a decomposition
  in the desired basis. The decomposition is unique as for all $x \in V(G)$, the coefficient
  associated to $\ccm(x)$ must be $f(x)$ since $\const_C(x)=0$ for all other connected component.
\end{proof}

\begin{corollary}
  \label{cor:dimension_locally_constant}
  \uses{thm:locally_constant_basis}
  The dimension of the space of locally constant functions is the number of
  connected components of $G$.
\end{corollary}

\section{Adjacency operator}

Let $G$ be a graph.

\subsection{Definition of the adjacency operator and action on constants}

Assume $G$ is locally finite.

\begin{definition}
  \label{def:adjacency_operator}
  \uses{def:locally_finite,def:dartset}
  We define the adjacency operator $a$ as the linear operator acting on the space of
  functions $f : V(G) \rightarrow \C$ by
  $$ a f (x) :=
  \sum_{d \in \dartset(d)}
  f(\ept(x)).$$
\end{definition}

\begin{lemma}
  \label{lem:adjacency_locally_constant}
  \uses{def:locally_constant,def:adjacency_operator,lem:adjacent_vs_dart,def:degree}
  Let $f$ be a locally constant function. Then, for all $x \in V(G)$,
  $af(x) = \deg(x) f(x)$.
\end{lemma}

\begin{proof}
  Let $x \in V(G)$.
  By definition,
  \begin{equation*}
    af(x) = \sum_{d \in \dartset(x)} f(\ept(d)).
  \end{equation*}
  By Lemma \ref{lem:adjacent_vs_dart},
  for all $d \in \dartset(x)$, $\ept(d)$ is adjacent to $x$
  and in particular $f(\ept(d))=f(x)$. This leads to the conclusion by
  Definition \ref{def:degree}.
\end{proof}

\begin{lemma}
  \label{lem:adjacency_of_constant}
  \uses{def:constant_one,def:adjacency_operator}
  For any $x \in V(G)$, $a \const(x) = \deg(x)$.
\end{lemma}

\subsection{Norm of the adjacency operator}

Let $G$ be a locally finite graph.
The aim of this subsection is to prove the following.

\begin{theorem}
  \label{thm:norm_adjacency_leq_sup_degree}
  \uses{lem:bound_a_sup_degree}
  Assume $G$ is locally bounded.
  Then the adjacency operator is a bounded operator on $\ell^2(G)$ and
  its norm satisfies $\|a\| \leq \sup_{x \in V(G)} \deg(x)$.
\end{theorem}

Here is a key lemma.

\begin{lemma}
  \label{lem:bound_a_degree_x}
  \uses{def:adjacency_operator,def:degree}
  For any function $f : V(G) \rightarrow \C$, any vertex $x \in V(G)$,
  \begin{equation}
    |af(x)|^2
    \leq \deg(x)
    \sum_{d \in \dartset(x)} |f(\ept(d))|^2.
  \end{equation}
  Furthermore, this is an equality if and only if
  for any $y, z$ adjacent to $x$, $f(y) = f(z)$.
\end{lemma}

\begin{proof}
  Let $f : V(G) \rightarrow \C$ and $x \in V(G)$.
  By Definition \ref{def:adjacency_operator},
  \begin{equation}
    |af(x)|^2
    = \Big| \sum_{d \in \dartset(x)} f(\ept(d))\Big|^2.
  \end{equation}
  By the Cauchy-Schwarz inequality applied to the complex vectors
  $v_1 := (1)_{d \in \dartset(x)}$ and $v_2 := (f(\ept(d)))_{d \in \dartset(x)}$
  we have
  \begin{align*}
    |af(x)|^2
    & = \left| v_1 \cdot v_2 \right|^2
    \leq \|v_1\|_2^2 \|v_2\|_2^2 \\
    &\leq
    \left( \sum_{d \in \dartset(x)} 1
    \right)
    \left( \sum_{d \in \dartset(x)} |f(\ept(d))|^2
    \right).
  \end{align*}
  This leads to the inequality by Definition \ref{def:degree}.
  The equality case comes from the equality case in Cauchy-Schwarz, which occurs if
  and only if the vectors $v_1$ and $v_2$
  are colinear, which
  is equivalent to the announced condition as $v_1$ is a non-zero constant vector,
  using Lemma \ref{lem:adjacent_vs_dart}.
\end{proof}

Then Proposition \ref{thm:norm_adjacency_leq_sup_degree} is a trivial consequence of the
following lemma, together with the definition of bounded operator and operator norm.

\begin{lemma}
  \label{lem:bound_a_sup_degree}
  \uses{lem:bound_a_degree_x,def:locally_bounded}
  Assume $G$ is locally bounded. Then, for any $f \in \ell^2(G)$,
  $a f \in \ell^2(G)$ and
  \begin{equation}
    \|a f\| \leq \sup_{x \in V(G)} \deg(x) \times \|f\|.
  \end{equation}
  Furthermore, the equality occurs if and only if $G$ is regular of degree $\delta$ for some
  non-negative integer $\delta$
  and, for any $x \in V(G)$, for any $y$ and $z$ adjacent to $x$, $f(y)=f(z)$.
\end{lemma}

\begin{proof}
Let us write $D := \sup_{x \in V(G)} \deg(x)$.
By definition,
\begin{equation*}
  \|af\|^2
  = \sum_{x \in V(G)} |af(x)|^2
\end{equation*}
and $af \in \ell^2(G)$ iff this sum is finite.
We sum Lemma \ref{lem:bound_a_degree_x} for all vertices of $G$ and obtain that
\begin{equation*}
  \_
  \leq  \sum_{x \in V(G)} \deg(x) \sum_{d \in \dartset(x)} |f(\ept(d))|^2
  \leq D \sum_{d \in D(G)} |f(\ept(d))|^2.
\end{equation*}
We apply the involution $\symm$ to the sum, changing indices, to obtain
\begin{equation*}
  \_
  = D \sum_{d \in D(G)} |f(\ept(\symm(d)))|^2
  = D \sum_{d \in D(G)} |f(\spt(d))|^2.
\end{equation*}
Now by Definitions \ref{def:dartset} and \ref{def:degree}
\begin{equation*}
  \_ = D \sum_{x \in V(G)} \sum_{x \in \dartset(x)} |f(\spt(d))|^2
  = D \sum_{x \in V(G)} \deg(x) |f(x)|^2
\leq D^2 \sum_{x \in V(G)} |f(x)|^2
  = D^2 \|f\|^2.
\end{equation*}
This means that $af \in \ell^2(G)$ and $\|af\| \leq D \|f\|$, which was our claim.
  If the equality occurs, since all terms are non-negative, it means that
  $\deg (x)$ is constant (i.e. the graph is regular), and that there is equality in
  each term of  Lemma \ref{lem:bound_a_degree_x}, which is the conclusion.
\end{proof}

\subsection{Adjacency operator is self-adjoint}

Let $G$ be a locally bounded graph.

\begin{proposition}
  \label{prop:adjacency_is_selfadjoint}
  \uses{lem:scalar_of_adjacency}
  The adjacency operator is selfadjoint.
\end{proposition}

Here is the key lemma.

\begin{lemma}
  \label{lem:scalar_of_adjacency}
  \uses{lem:bound_a_sup_degree}
  For any $f$, $g$ in $\ell^2(G)$,
  \begin{equation}
    \langle af, g \rangle
    = \sum_{d \in D(G)}
    f(\ept(d)) \overline{g(\spt(d))}.
  \end{equation}
\end{lemma}

\begin{proof}
  Let $f$, $g$ be elements of $\ell^2(G)$.
  By Proposition \ref{lem:bound_a_sup_degree}, $a f \in \ell^2(G)$.
  By definition of the scalar product,
  \begin{equation}
    \langle af, g \rangle
    = \sum_{x \in V(G)} af(x) \overline{g(x)}.
  \end{equation}
  By Definition \ref{def:adjacency_operator},
  \begin{equation}
    \langle af, g \rangle
    = \sum_{x \in V(G)}
    \sum_{d \in \dartset(x)}
    f(\ept(d)) \overline{g(x)}
  \end{equation}
  which we can rewrite as the claim.
\end{proof}

We are now ready to prove Proposition \ref{prop:adjacency_is_selfadjoint}.

\begin{proof}
  Let $f$, $g$ be elements of $\ell^2(G)$.
  We have by Lemma \ref{lem:scalar_of_adjacency}
  \begin{equation*}
    \langle af, g \rangle
    = \sum_{d \in D(G)}
    f(\ept(d)) \overline{g(\spt(d))}
    = \overline{\sum_{d \in D(G)}
    g(\ept(d)) \overline{f(\spt(d))}}
  \end{equation*}
  by complex conjugation and applying the involution $\symm$ to exchange the
  start and end of each dart.
  Hence by Lemma \ref{lem:scalar_of_adjacency}
  \begin{equation*}
    \langle af, g \rangle
    = \overline{\langle ag, f \rangle} = \langle f, ag \rangle.
  \end{equation*}
  This means that $a^*=a$ by definition of
  the adjoint, which means $a$ is self-adjoint by definition.
\end{proof}

\begin{corollary}
  \label{cor:spectrum_is_real}
  \uses{prop:adjacency_is_selfadjoint}
  The spectrum of the adjacency operator is real.
\end{corollary}

\begin{proof}
  This follows from Proposition \ref{prop:adjacency_is_selfadjoint} with
  selfAdjoint.mem\_spectrum\_eq\_re.
\end{proof}

\begin{lemma}
  \label{lem:spectrum_in_segment}
  \uses{cor:spectrum_is_real,thm:norm_adjacency_leq_sup_degree}
  The spectrum of $a$ is included in the
  segment $[-D,D]$ where $D = \sup_{x \in V(G)} \deg(x)$.
\end{lemma}

\begin{proof}
  By Corollary \ref{cor:spectrum_is_real}, the spectrum of $a$ is real.
  By spectrum.subset\_closedBall\_norm,
  it is included in the closed ball of center $0$ and
  radius $\|a\|$.
  We have $\|a\| \leq D$ by Theorem \ref{thm:norm_adjacency_leq_sup_degree}.
\end{proof}

\begin{lemma}
  \label{lem:spectrum_finite}
  \uses{prop:adjacency_is_selfadjoint,thm:norm_adjacency_leq_sup_degree}
  If $V(G)$ is finite, then the spectrum of the adjacency operator
  is a family of $\# V(G)$ eigenvalues.
\end{lemma}

\begin{proof}
  If $V(G)$ is finite, then $\ell^2(G)$ has finite dimension.
  So this is just the spectral theorem for self-adjoint operators in finite
  dimension.
\end{proof}

\subsection{From adjacency operator to graph}

We now introduce a construction allowing to go from adjacency operator to graph,
which will be useful to define random graphs.

We first make a few observations as to the properties of adjacency operators on locally
finite graphs.

\begin{lemma}
  \label{lem:coefficients_adjacency_expression}
  \uses{def:dartset_pair,lem:scalar_of_adjacency,def:indicator_function}
  Let $x, y \in V(G)$. Then
  \begin{equation*}
    \langle a \const_{\{x\}}, \const_{\{y\}} \rangle
    = \# \dartset(x,y).
  \end{equation*}
\end{lemma}

\begin{proof}
  The functions $\const_{\{x\}}$ and $\const_{\{y\}}$ are trivially in $\ell^2(G)$.
  By Lemma \ref{lem:scalar_of_adjacency},
  \begin{equation*}
    \langle a \const_{\{x\}}, \const_{\{y\}} \rangle
    = \sum_{d \in D(G)} \const_{\{x\}}(\spt(d)) \overline{\const_{\{y\}}(\ept(d))}
  \end{equation*}
  which is exactly the claim by Definition \ref{def:dartset_pair} and Definition
  \ref{def:indicator_function}.
\end{proof}

\begin{lemma}
  \label{lem:coefficients_adjacency_properties}
  \uses{lem:coefficients_adjacency_expression,lem:darset_loop_even}
  For any $x, y \in V(G)$,
  $\langle a \const_{\{x\}}, \const_{\{y\}} \rangle$ is a non-negative integer,
  which is even as soon as $x=y$.
\end{lemma}

\begin{proof}
  By Lemma \ref{lem:coefficients_adjacency_expression}, this quantity is a cardinal
  of a set, and hence a non-negative integer. The parity when $x=y$ comes from Lemma
  \ref{lem:darset_loop_even}.
\end{proof}

\begin{definition}
  \label{def:adjacency_like}
  Let $V$ be a set.
  An operator $a : V^{\C} \rightarrow V^{\C}$ is \emph{adjacency-like}
  if it satisfies the following properties:
  \begin{itemize}
    \item for all $x \in V$, $a \const_{\{x\}} \in \ell^2(G)$;
    \item for all $x, y \in V$,
    $a_{x,y} := \langle a \const_{\{x\}}, \const_{\{y\}} \rangle$ is a non-negative
    integer;
    \item for all $x, y \in V$, $a_{x,y}=a_{y,x}$;
    \item for all $x \in V$, $a_{x,x}$ is even.
  \end{itemize}
\end{definition}

We then associate to any adjacent-like operator a dart-like structure.

\begin{definition}
  \label{def:dartlike_of_adjlike}
  \uses{def:adjacency_like,def:dartlike}
  Let $V$ be a set and $a$ be an adjacency-like operator on $V$.
  We define a dart-like structure on $V$ by taking:
  \begin{itemize}
    \item $D$ is the set of $(x,y,i)$ where $x \in V$, $y \in V$, and $i$ is an integer such that
    \begin{itemize}
      \item if $x \neq y$ then $1 \leq i \leq a_{x,y}$;
      \item if $x=y$ then $1 \leq |i| \leq a_{x,x}$.
    \end{itemize}
    \item for any $(x,y,i) \in D$, we let $\spt(x,y,i)=x$, $\ept(x,y,i)=y$ and
    \begin{equation*}
      \symm(x,y,i) := \begin{cases}
        \symm(y,x,i) & \text{if } x \neq y \\
        \symm(x,y,-i) & \text{if } x = y.
      \end{cases}
    \end{equation*}
  \end{itemize}
\end{definition}

\begin{definition}
  \label{def:graph_of_adjlike}
  \uses{def:graph_of_dart,def:dartlike_of_adjlike}
  Let $a$ be a adjacency-like operator on $V$.
  We define the graph associated to $a$ by taking the graph associated to the dartlike structure
  associated to $a$.
\end{definition}

\begin{lemma}
  \label{lem:adjacency_of_graph_of_adjacency}
  \uses{def:graph_of_adjlike}
  Let $a$ be a adjacency-like operator on $V$.
  Then the graph $G$ associated to $a$ is a graph, of vertex set $V$, and adjacency operator $a$.
\end{lemma}

\begin{lemma}
  \label{lem:adjlike_addition}
  \uses{def:adjacency_like}
  Let $V$ be a set. The space of adjacency-like operators on $V$ is stable by addition, i.e.
  if $a$, $a'$ are adjacency-like, so is $a+a'$.
\end{lemma}

\section{Permutation graphs}

Let $V$ be a finite set and $\perm{V} = \{ \pi : V \rightarrow V \text{ bijective}\}$
the set of permutations of $V$.

We define a graph associated to a family of permutations.

\begin{definition}
  \label{def:dart_of_pi}
  \uses{def:dartlike}
  Let $k \geq 1$ be an integer. To a family $\vec{\pi} = (\pi_1, \ldots, \pi_k) \in \perm{V}^k$
  we associate a dart-like structure on $V$ by taking:
  \begin{itemize}
    \item $D = V \times \{1, \ldots, k\} \times \{-1,+1\}$
    \item for $(x,i,\epsilon) \in D$, we let $\spt(x,i,\epsilon) = x$,
    $\ept(x,i,\epsilon) = \pi_i^\epsilon(x)$ and
    $\symm(x,i,\epsilon) = (\pi_i^\epsilon(x),i,-\epsilon)$.
  \end{itemize}
\end{definition}

\begin{proof}
  We check that
  \begin{equation*}
    \spt(\symm(x,i,\epsilon))
    = \spt(\pi_i^\epsilon(x),i,-\epsilon)
    = \pi_i^\epsilon(x)
    = \ept(x,i,\epsilon)
  \end{equation*}
  and
  \begin{equation*}
    \ept(\symm(x,i,\epsilon))
    = \ept(\pi_i^\epsilon(x),i,-\epsilon)
    = \pi_i^{-\epsilon}(\pi_i^\epsilon(x))
    = x = \spt(x,i,\epsilon)
  \end{equation*}
  and
  \begin{equation*}
    \symm(\symm(x,i,\epsilon))
    = \symm((\pi_i^\epsilon(x),i,-\epsilon))
    = (\pi_i^{-\epsilon}(\pi_i^\epsilon(x)),i,--\epsilon)
    = (x,i,\epsilon).
  \end{equation*}
\end{proof}

\begin{definition}
  \label{def:graph_of_pi}
  \uses{def:dart_of_pi,def:graph_of_dart}
   Let $k \geq 1$ be an integer. To a family $\vec{\pi} \in \perm{V}^k$
  we associate a graph $G_{\vec{\pi}}$ on $V$ by taking the graph associated to the dart-like
  structure associated to $\vec{\pi}$.
\end{definition}

\begin{lemma}
  \label{lem:dartset_pair_pi}
  \uses{def:dartset_pair,def:graph_of_pi}
  Let $k \geq 1$ be an integer and take $\vec{\pi} = (\pi_1, \ldots, \pi_k) \in \perm{V}^k$.
  Then, for any $x, y \in V$,
  \begin{equation*}
    \dartset(x,y) = \{(x,i,\epsilon): y = \pi_i^\epsilon(x)\}.
  \end{equation*}
\end{lemma}

\begin{lemma}
  \label{lem:dartset_pi}
  \uses{lem:dartset_pair_pi}
  Let $k \geq 1$ be an integer and take $\vec{\pi} = (\pi_1, \ldots, \pi_k) \in \perm{V}^k$.
  Then, for any $x \in V$,
  \begin{equation*}
    \dartset(x) = \{(x,i,\epsilon): 1 \leq i \leq k, \epsilon = \pm 1\}.
  \end{equation*}
\end{lemma}

\begin{lemma}
  \label{lem:graph_pi_regular}
  \uses{lem:dartset_pi,def:regular}
  The graph $G_{\vec{\pi}}$ is regular of degree $2k$.
\end{lemma}

[I need to decide the conventions about the side of the actions below]

\begin{definition}
  \label{def:u_pi}
  For $\pi \in \perm{V}$, we define an operator $u_\pi : V^{\C} \rightarrow V^{\C}$ by
  letting, for $f : V \rightarrow \C$,
  \begin{equation*}
    \forall x \in V,
    u_\pi f(x) = f(\pi^{-1}(x))
  \end{equation*}
\end{definition}

\begin{lemma}
  \label{lem:u_pi_unitary}
  \uses{def:u_pi}
  For $\pi \in \perm{V}$, the operator $u_\pi$ is a unitary operator on $\ell^2(V)$
  and $u_\pi^*=u_\pi^{-1}=u_{\pi^{-1}}$.
\end{lemma}

\begin{lemma}
  \label{lem:adjacency_of_pi}
  \uses{def:u_pi,def:adjacency_operator,lem:u_pi_unitary}
  Let $k \geq 1$ be an integer. For any family $\vec{\pi} = (\pi_1, \ldots, \pi_k) \in \perm{V}^k$,
  the adjacency operator $a_{\vec{\pi}}$ of $G_{\vec{\pi}}$ can be written as
  \begin{equation*}
    a_{\vec{\pi}} = \sum_{i=1}^k (u_{\pi_i} + u_{\pi_i}^*).
  \end{equation*}
\end{lemma}

\begin{proof}
  We have by definition of the adjacency operator for a function $f : V \rightarrow \C$
  and $x \in V$,
  \begin{equation*}
    af(x)
    = \sum_{d \in \dartset(x)} f(\ept(d))
    = \sum_{i=1}^k \sum_{\epsilon = \pm 1} f(\pi_i^\epsilon(x))
    =  \sum_{i=1}^k (f(\pi_i^{-1}(x)) + f(\pi_i(x)))
  \end{equation*}
  which leads to the conclusion as we recognise $u_{\pi_i}$ and $u_{\pi_i^{-1}} = u_{\pi_i}^*$.
\end{proof}

In what follows, we write $\perm{n}$ for the set of permutations of $[n]$.

\begin{definition}
  \label{def:random_perm_graph}
  \uses{def:graph_of_pi}
  Let $k, n \geq 1$ be integers.
  A \emph{random permutation graph of degree $2k$ with $n$ vertices} is the graph associated to
  a family $\vec{\pi} = (\pi_1, \ldots, \pi_k) \in \perm{n}$ of $k$ i.i.d. uniform elements of
  $\perm{n}$.
  We denote by $\Prob$ the corresponding probability measure on the space
  of $\de$ regular graphs with vertex set $[n]$.
\end{definition}
